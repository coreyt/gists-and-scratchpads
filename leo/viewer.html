<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Scrubbai - Markdown Viewer & Editor</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <!-- marked.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>

    <!-- Mermaid.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.min.js"></script>

    <style>
        :root {
            /* PLF Neutral Colors */
            --neutral-white: #FFFFFF;
            --neutral-lightest: #EEEEEE;
            --neutral-light: #DFDFDF;
            --neutral-medium: #D1D1D1;
            --neutral-dark: #B2B4AE;
            --neutral-darkest: #707070;

            /* PLF Accent Colors */
            --accent-button: #414141;
            --accent-primary: #1C5687;

            /* PLF Patient Status Colors */
            --status-green: #3A913F;
            --status-blue: #2B72CC;
            --status-yellow: #FFD200;
            --status-red: #EB0000;

            /* Legacy Stryker Colors (for gradients/special elements) */
            --stryker-red: #E30613;
            --stryker-navy: #002856;
        }

        body {
            background-color: var(--neutral-lightest);
            color: var(--accent-button);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        .header {
            background: var(--neutral-white);
            color: var(--accent-primary);
            padding: 1.5rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
            border-bottom: 3px solid var(--accent-primary);
        }

        .header h1 {
            font-weight: 600;
            margin: 0;
            font-size: 2rem;
            color: var(--accent-primary);
        }

        .header p {
            margin: 0.5rem 0 0 0;
            color: var(--neutral-darkest);
            font-size: 0.95rem;
        }

        .editor-container {
            background: var(--neutral-white);
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            margin-bottom: 2rem;
        }

        .textarea-wrapper {
            position: relative;
            margin-bottom: 1.5rem;
        }

        #markdownInput {
            width: 100%;
            min-height: 400px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border: 2px solid var(--neutral-light);
            border-radius: 6px;
            padding: 1rem;
            resize: vertical;
            transition: border-color 0.3s ease;
            background-color: var(--neutral-white);
        }

        #markdownInput:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 0.2rem rgba(28, 86, 135, 0.15);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: 6px;
            margin-bottom: 1.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .status-indicator::before {
            content: '';
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 0.75rem;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .status-valid {
            background-color: rgba(58, 145, 63, 0.1);
            color: var(--status-green);
            border: 1px solid rgba(58, 145, 63, 0.3);
        }

        .status-valid::before {
            background-color: var(--status-green);
        }

        .status-warning {
            background-color: rgba(255, 210, 0, 0.1);
            color: #705c00;
            border: 1px solid rgba(255, 210, 0, 0.3);
        }

        .status-warning::before {
            background-color: var(--status-yellow);
        }

        .status-error {
            background-color: rgba(235, 0, 0, 0.1);
            color: var(--status-red);
            border: 1px solid rgba(235, 0, 0, 0.3);
        }

        .status-error::before {
            background-color: var(--status-red);
        }

        .btn-stryker-primary {
            background-color: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
            font-weight: 500;
            /* Touch target size: min 50px height (13mm at 96 DPI) */
            padding: 0.75rem 1.75rem;
            min-height: 50px;
            transition: all 0.3s ease;
            border-radius: 6px;
        }

        .btn-stryker-primary:hover {
            background-color: #154566;
            border-color: #154566;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(28, 86, 135, 0.3);
        }

        .btn-stryker-secondary {
            background-color: var(--neutral-white);
            border: 2px solid var(--accent-button);
            color: var(--accent-button);
            font-weight: 500;
            /* Touch target size: min 50px height (13mm at 96 DPI) */
            padding: 0.75rem 1.75rem;
            min-height: 50px;
            transition: all 0.3s ease;
            border-radius: 6px;
        }

        .btn-stryker-secondary:hover {
            background-color: var(--accent-button);
            border-color: var(--accent-button);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(65, 65, 65, 0.3);
        }

        .button-group {
            display: flex;
            /* Spacing between buttons: min 6mm (~23px) */
            gap: 1.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .preview-container {
            background: var(--neutral-white);
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            min-height: 300px;
        }

        .preview-header {
            color: var(--accent-primary);
            font-weight: 600;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--accent-primary);
        }

        #markdownPreview {
            line-height: 1.6;
        }

        /* Styled Markdown Output */
        #markdownPreview h1,
        #markdownPreview h2,
        #markdownPreview h3,
        #markdownPreview h4,
        #markdownPreview h5,
        #markdownPreview h6 {
            color: var(--accent-primary);
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        #markdownPreview h1 {
            font-size: 2rem;
            border-bottom: 3px solid var(--accent-primary);
            padding-bottom: 0.5rem;
        }

        #markdownPreview h2 {
            font-size: 1.75rem;
            border-bottom: 2px solid var(--neutral-light);
            padding-bottom: 0.4rem;
        }

        #markdownPreview h3 {
            font-size: 1.5rem;
        }

        #markdownPreview p {
            margin-bottom: 1rem;
        }

        #markdownPreview code {
            background-color: var(--neutral-lightest);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: var(--accent-primary);
        }

        #markdownPreview pre {
            background-color: var(--accent-button);
            color: white;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            margin: 1rem 0;
        }

        #markdownPreview pre code {
            background-color: transparent;
            color: white;
            padding: 0;
        }

        #markdownPreview blockquote {
            border-left: 4px solid var(--accent-primary);
            padding-left: 1rem;
            margin-left: 0;
            color: var(--neutral-darkest);
        }

        #markdownPreview a {
            color: var(--accent-primary);
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: border-color 0.3s ease;
        }

        #markdownPreview a:hover {
            border-bottom-color: var(--accent-primary);
        }

        #markdownPreview ul,
        #markdownPreview ol {
            margin-bottom: 1rem;
            padding-left: 2rem;
        }

        #markdownPreview li {
            margin-bottom: 0.5rem;
        }

        #markdownPreview table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        #markdownPreview th,
        #markdownPreview td {
            border: 1px solid var(--neutral-light);
            padding: 0.75rem;
            text-align: left;
        }

        #markdownPreview th {
            background-color: var(--accent-primary);
            color: white;
            font-weight: 600;
        }

        #markdownPreview tr:nth-child(even) {
            background-color: var(--neutral-lightest);
        }

        #markdownPreview img {
            max-width: 100%;
            height: auto;
            border-radius: 6px;
            margin: 1rem 0;
        }

        #markdownPreview hr {
            border: 0;
            height: 2px;
            background: linear-gradient(to right, var(--accent-primary), var(--accent-button));
            margin: 2rem 0;
        }

        .empty-state {
            text-align: left;
            color: var(--neutral-dark);
            padding: 3rem 0;
        }

        footer {
            text-align: left;
            padding: 2rem 0;
            color: var(--neutral-darkest);
            font-size: 0.9rem;
        }

        /* Form label styling */
        .form-label {
            color: var(--accent-primary);
        }

        /* Side-by-Side Layout Styles */
        .mode-side-by-side .view-mode-container {
            display: flex;
            gap: 1.5rem;
            align-items: stretch;
            height: calc(100vh - 180px); /* Adjust based on header/footer height */
            min-height: 500px;
        }

        .mode-side-by-side .editor-container,
        .mode-side-by-side .preview-container {
            flex: 1;
            margin-bottom: 0;
            overflow: hidden; /* Manage internal scrolling */
            display: flex;
            flex-direction: column;
            width: 50%; /* Explicitly set width to enforce even split */
        }

        .mode-side-by-side .textarea-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            margin-bottom: 1rem;
        }

        .mode-side-by-side #markdownInput {
            flex: 1;
            resize: none; /* Disable manual resize in side-by-side mode */
            height: 100% !important; /* Override min-height */
            min-height: 0;
        }

        .mode-side-by-side #markdownPreview {
            overflow-y: auto;
            flex: 1;
            padding-right: 0.5rem; /* Add some padding for scrollbar */
        }

        /* Custom Scrollbar for side-by-side panels */
        .mode-side-by-side #markdownInput::-webkit-scrollbar,
        .mode-side-by-side #markdownPreview::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .mode-side-by-side #markdownInput::-webkit-scrollbar-track,
        .mode-side-by-side #markdownPreview::-webkit-scrollbar-track {
            background: var(--neutral-lightest);
            border-radius: 4px;
        }

        .mode-side-by-side #markdownInput::-webkit-scrollbar-thumb,
        .mode-side-by-side #markdownPreview::-webkit-scrollbar-thumb {
            background: var(--neutral-medium);
            border-radius: 4px;
        }

        .mode-side-by-side #markdownInput::-webkit-scrollbar-thumb:hover,
        .mode-side-by-side #markdownPreview::-webkit-scrollbar-thumb:hover {
            background: var(--neutral-dark);
        }

        /* Hide elements that might clutter side-by-side view if needed */
        .mode-side-by-side .header {
            margin-bottom: 1rem;
        }

        /* Responsive override: Disable side-by-side on small screens */
        @media (max-width: 767.98px) {
            .mode-side-by-side .view-mode-container {
                display: block;
                height: auto;
            }
            .mode-side-by-side .editor-container,
            .mode-side-by-side .preview-container {
                width: 100%;
                overflow: visible;
                height: auto;
            }
            .mode-side-by-side #markdownInput {
                height: auto !important;
                resize: vertical;
            }
            .mode-side-by-side #markdownPreview {
                overflow-y: visible;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container d-flex justify-content-between align-items-center flex-wrap">
            <div>
                <h1>View Scrubbai</h1>
                <p>Professional Markdown Viewer & Editor</p>
            </div>
            <div class="settings-panel d-flex align-items-center gap-3 mt-3 mt-md-0">
                <div class="form-check form-switch d-none d-md-block">
                    <input class="form-check-input" type="checkbox" id="layoutToggle">
                    <label class="form-check-label" for="layoutToggle">Side-by-Side</label>
                </div>
                <div id="widthControl" class="d-none d-flex align-items-center gap-2">
                    <label for="widthSlider" class="form-label mb-0 small text-nowrap">Width:</label>
                    <input type="range" class="form-range" id="widthSlider" min="50" max="100" value="80" style="width: 100px;">
                </div>
            </div>
        </div>
    </div>

    <div id="mainContainer" class="container">
        <div class="view-mode-container">
            <div class="editor-container">
                <div class="textarea-wrapper">
                    <label for="markdownInput" class="form-label fw-bold" style="color: var(--stryker-navy);">
                        Markdown Editor
                    </label>
                    <textarea
                        id="markdownInput"
                        class="form-control"
                        rows="20"
                        placeholder="Type or paste your markdown here...&#10;&#10;# Example Heading&#10;&#10;This is a **bold** statement with *italic* text.&#10;&#10;- List item 1&#10;- List item 2&#10;&#10;```javascript&#10;console.log('Hello, World!');&#10;```&#10;&#10;```mermaid&#10;graph TD;&#10;    A-->B;&#10;```"
                    ></textarea>
                </div>

                <div id="statusIndicator" class="status-indicator status-valid">
                    Valid markdown - No issues detected
                </div>

                <div class="button-group">
                    <button id="clearBtn" class="btn btn-stryker-secondary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16" style="margin-right: 0.5rem; vertical-align: text-bottom;">
                            <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                            <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                        </svg>
                        Clear
                    </button>
                    <button id="rerenderBtn" class="btn btn-stryker-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-clockwise" viewBox="0 0 16 16" style="margin-right: 0.5rem; vertical-align: text-bottom;">
                            <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z"/>
                            <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466"/>
                        </svg>
                        Re-render
                    </button>
                </div>
            </div>

            <div class="preview-container">
                <h2 class="preview-header fw-bold" style="color: var(--stryker-navy); font-size: 1rem; margin-bottom: 0.5rem; border-bottom: none; padding-bottom: 0;">
                    Preview
                </h2>
                <div id="markdownPreview" class="empty-state">
                    Your rendered markdown will appear here...
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2024 View Scrubbai. Built with marked.js and Bootstrap 5.</p>
        </div>
    </footer>

    <!-- Bootstrap 5 JS Bundle (optional for this use case, but included for completeness) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <script>
        // Initialize Mermaid
        mermaid.initialize({ startOnLoad: false });

        // Configure custom renderer for marked
        const renderer = new marked.Renderer();
        const originalCodeRenderer = renderer.code.bind(renderer);
        renderer.code = function(code, language, isEscaped) {
            if (language === 'mermaid') {
                return '<div class="mermaid">' + code + '</div>';
            }
            return originalCodeRenderer(code, language, isEscaped);
        };

        // Initialize marked.js configuration
        marked.setOptions({
            breaks: true,
            gfm: true,
            headerIds: true,
            mangle: false,
            sanitize: false,
            renderer: renderer
        });

        // DOM elements
        const markdownInput = document.getElementById('markdownInput');
        const markdownPreview = document.getElementById('markdownPreview');
        const statusIndicator = document.getElementById('statusIndicator');
        const clearBtn = document.getElementById('clearBtn');
        const rerenderBtn = document.getElementById('rerenderBtn');

        const layoutToggle = document.getElementById('layoutToggle');
        const widthSlider = document.getElementById('widthSlider');
        const widthControl = document.getElementById('widthControl');
        const mainContainer = document.getElementById('mainContainer');

        // Debounce timer
        let debounceTimer;

        // View Mode Handlers
        function toggleLayout() {
            const isSideBySide = layoutToggle.checked;

            if (isSideBySide) {
                document.body.classList.add('mode-side-by-side');
                widthControl.classList.remove('d-none');

                // Set initial container width from slider
                updateContainerWidth();

                // Initialize scroll sync
                initScrollSync();
            } else {
                document.body.classList.remove('mode-side-by-side');
                widthControl.classList.add('d-none');

                // Reset container width
                mainContainer.style.maxWidth = '';

                // Remove scroll sync
                removeScrollSync();
            }
        }

        function updateContainerWidth() {
            if (layoutToggle.checked) {
                const width = widthSlider.value;
                mainContainer.style.maxWidth = `${width}%`;
            }
        }

        // Scroll Sync Logic
        let isSyncingLeftScroll = false;
        let isSyncingRightScroll = false;

        function syncScrollLeft(e) {
            if (!layoutToggle.checked) return;
            if (isSyncingLeftScroll) {
                isSyncingLeftScroll = false;
                return;
            }

            isSyncingRightScroll = true;

            // Calculate percentage
            const percentage = markdownInput.scrollTop / (markdownInput.scrollHeight - markdownInput.offsetHeight);

            // Apply to preview
            markdownPreview.scrollTop = percentage * (markdownPreview.scrollHeight - markdownPreview.offsetHeight);
        }

        function syncScrollRight(e) {
            if (!layoutToggle.checked) return;
            if (isSyncingRightScroll) {
                isSyncingRightScroll = false;
                return;
            }

            isSyncingLeftScroll = true;

            // Calculate percentage
            const percentage = markdownPreview.scrollTop / (markdownPreview.scrollHeight - markdownPreview.offsetHeight);

            // Apply to editor
            markdownInput.scrollTop = percentage * (markdownInput.scrollHeight - markdownInput.offsetHeight);
        }

        function initScrollSync() {
            markdownInput.addEventListener('scroll', syncScrollLeft);
            markdownPreview.addEventListener('scroll', syncScrollRight);
        }

        function removeScrollSync() {
            markdownInput.removeEventListener('scroll', syncScrollLeft);
            markdownPreview.removeEventListener('scroll', syncScrollRight);

            // Reset flags
            isSyncingLeftScroll = false;
            isSyncingRightScroll = false;
        }

        /**
         * Lint the markdown content and return status
         */
        function lintMarkdown(content) {
            if (!content.trim()) {
                return {
                    status: 'valid',
                    message: 'Valid markdown - No issues detected'
                };
            }

            const issues = [];
            const lines = content.split('\n');

            // Check for common markdown issues

            // 1. Check for mismatched header levels (skipping levels)
            const headerMatches = content.match(/^#{1,6}\s/gm);
            if (headerMatches) {
                const headerLevels = headerMatches.map(h => h.trim().split(' ')[0].length);
                for (let i = 1; i < headerLevels.length; i++) {
                    if (headerLevels[i] - headerLevels[i - 1] > 1) {
                        issues.push('Skipped header level detected');
                        break;
                    }
                }
            }

            // 2. Check for unclosed code blocks
            const codeBlockMatches = content.match(/```/g);
            if (codeBlockMatches && codeBlockMatches.length % 2 !== 0) {
                return {
                    status: 'error',
                    message: 'Syntax error - Unclosed code block detected'
                };
            }

            // 3. Check for unclosed inline code
            const inlineCodeMatches = content.match(/`/g);
            if (inlineCodeMatches) {
                let count = 0;
                for (let line of lines) {
                    // Ignore code blocks
                    if (line.trim().startsWith('```')) continue;
                    const backticks = (line.match(/`/g) || []).length;
                    count += backticks;
                }
                // If we're not in a code block and have odd backticks, it's an error
                if (!codeBlockMatches && count % 2 !== 0) {
                    return {
                        status: 'error',
                        message: 'Syntax error - Unclosed inline code detected'
                    };
                }
            }

            // 4. Check for malformed links
            const linkPattern = /\[([^\]]+)\]\(([^)]+)\)/g;
            const malformedLinks = content.match(/\[[^\]]*\]\([^)]*$/gm);
            if (malformedLinks) {
                return {
                    status: 'error',
                    message: 'Syntax error - Malformed link detected'
                };
            }

            // 5. Check for inconsistent list formatting
            const listItems = content.match(/^\s*[-*+]\s/gm);
            if (listItems) {
                const markers = listItems.map(item => item.trim()[0]);
                const uniqueMarkers = [...new Set(markers)];
                if (uniqueMarkers.length > 1) {
                    issues.push('Inconsistent list markers');
                }
            }

            // 6. Check for multiple consecutive blank lines (minor issue)
            if (content.match(/\n\s*\n\s*\n/)) {
                issues.push('Multiple consecutive blank lines');
            }

            // 7. Check for trailing spaces (minor formatting issue)
            const trailingSpaces = lines.filter(line => line.match(/\s+$/));
            if (trailingSpaces.length > 2) {
                issues.push('Excessive trailing spaces');
            }

            // Return status based on issues found
            if (issues.length === 0) {
                return {
                    status: 'valid',
                    message: 'Valid markdown - No issues detected'
                };
            } else {
                return {
                    status: 'warning',
                    message: `Minor formatting issues - ${issues.join(', ')}`
                };
            }
        }

        /**
         * Update the status indicator
         */
        function updateStatus(lintResult) {
            statusIndicator.className = 'status-indicator';

            switch (lintResult.status) {
                case 'valid':
                    statusIndicator.classList.add('status-valid');
                    break;
                case 'warning':
                    statusIndicator.classList.add('status-warning');
                    break;
                case 'error':
                    statusIndicator.classList.add('status-error');
                    break;
            }

            statusIndicator.textContent = lintResult.message;
        }

        /**
         * Render markdown to HTML
         */
        function renderMarkdown() {
            const content = markdownInput.value;

            // Lint the markdown
            const lintResult = lintMarkdown(content);
            updateStatus(lintResult);

            // Render the markdown
            if (!content.trim()) {
                markdownPreview.innerHTML = '<div class="empty-state">Your rendered markdown will appear here...</div>';
                return;
            }

            try {
                const html = marked.parse(content);
                markdownPreview.innerHTML = html;

                // Initialize Mermaid diagrams
                mermaid.run({
                    nodes: document.querySelectorAll('.mermaid')
                });
            } catch (error) {
                markdownPreview.innerHTML = `<div class="alert alert-danger">
                    <strong>Rendering Error:</strong> ${error.message}
                </div>`;
                updateStatus({
                    status: 'error',
                    message: 'Syntax error - Failed to render markdown'
                });
            }
        }

        /**
         * Debounced render function
         */
        function debouncedRender() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(renderMarkdown, 300);
        }

        /**
         * Clear the textarea
         */
        function clearEditor() {
            markdownInput.value = '';
            renderMarkdown();
            markdownInput.focus();
        }

        // Event listeners
        markdownInput.addEventListener('input', debouncedRender);
        clearBtn.addEventListener('click', clearEditor);
        rerenderBtn.addEventListener('click', renderMarkdown);

        layoutToggle.addEventListener('change', toggleLayout);
        widthSlider.addEventListener('input', updateContainerWidth);

        // Initial render
        renderMarkdown();

        // Fallback check for marked.js
        if (typeof marked === 'undefined') {
            markdownPreview.innerHTML = `
                <div class="alert alert-danger">
                    <strong>Error:</strong> Failed to load marked.js library. Please check your internet connection.
                </div>
            `;
        }
    </script>
</body>
</html>
