<?xml version="1.0" ?>
<!-- Rigid body collision test following AdvancedResponseConstraintBased.scn pattern -->
<Node name="root" dt="0.001" gravity="0 0 -9810">
    <RequiredPlugin name="Sofa.Component.AnimationLoop"/>
    <RequiredPlugin name="Sofa.Component.Collision.Detection.Algorithm"/>
    <RequiredPlugin name="Sofa.Component.Collision.Detection.Intersection"/>
    <RequiredPlugin name="Sofa.Component.Collision.Geometry"/>
    <RequiredPlugin name="Sofa.Component.Collision.Response.Contact"/>
    <RequiredPlugin name="Sofa.Component.Constraint.Lagrangian.Correction"/>
    <RequiredPlugin name="Sofa.Component.Constraint.Lagrangian.Solver"/>
    <RequiredPlugin name="Sofa.Component.LinearSolver.Iterative"/>
    <RequiredPlugin name="Sofa.Component.Mapping.NonLinear"/>
    <RequiredPlugin name="Sofa.Component.Mass"/>
    <RequiredPlugin name="Sofa.Component.ODESolver.Backward"/>
    <RequiredPlugin name="Sofa.Component.StateContainer"/>
    <RequiredPlugin name="Sofa.Component.Topology.Container.Constant"/>

    <!-- Collision pipeline with constraint-based response -->
    <FreeMotionAnimationLoop/>
    <CollisionPipeline/>
    <BruteForceBroadPhase/>
    <BVHNarrowPhase/>
    <LocalMinDistance alarmDistance="2" contactDistance="1" angleCone="0.0"/>
    <CollisionResponse response="FrictionContactConstraint"/>
    <LCPConstraintSolver maxIt="1000" tolerance="0.001"/>

    <!-- Floor: static mesh (note: no Rigid3, just Vec3d positions) -->
    <Node name="Floor">
        <MeshTopology name="topology"
            position="-50 -50 -5  50 -50 -5  -50 50 -5  50 50 -5  -50 -50 0  50 -50 0  -50 50 0  50 50 0"
            hexas="0 1 3 2 4 5 7 6"/>
        <MechanicalObject name="mstate"/>
        <TriangleCollisionModel moving="false" simulated="false"/>
        <LineCollisionModel moving="false" simulated="false"/>
        <PointCollisionModel moving="false" simulated="false"/>
    </Node>

    <!-- Box: Rigid body (Rigid3) with collision mesh in child node -->
    <Node name="Box">
        <EulerImplicitSolver rayleighStiffness="0.1" rayleighMass="0.1"/>
        <CGLinearSolver iterations="25" tolerance="1e-9" threshold="1e-9"/>
        <!-- Rigid3 DOF: position=[0,0,20] quaternion=[1,0,0,0] -->
        <MechanicalObject name="rigidDOF" template="Rigid3" position="0 0 20 0 0 0 1"/>
        <UniformMass totalMass="0.1"/>
        <UncoupledConstraintCorrection/>

        <!-- Collision mesh in child node -->
        <Node name="Collision">
            <MeshTopology name="topology"
                position="-5 -5 -5  5 -5 -5  -5 5 -5  5 5 -5  -5 -5 5  5 -5 5  -5 5 5  5 5 5"
                hexas="0 1 3 2 4 5 7 6"/>
            <MechanicalObject name="collisionState"/>
            <TriangleCollisionModel/>
            <LineCollisionModel/>
            <PointCollisionModel/>
            <RigidMapping input="@../rigidDOF" output="@collisionState"/>
        </Node>
    </Node>
</Node>
